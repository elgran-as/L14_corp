<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Planificación - L14 Corp</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="/styles.css" />
    <!-- Calendario -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/es.js"></script>
</head>

<body class="bg-white text-slate-900 flex flex-col min-h-screen">
    <header class="fixed top-0 left-0 w-full bg-white border-b border-slate-200 shadow z-30">
        <div
            class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 flex items-center justify-between flex-wrap sm:flex-nowrap gap-3">
            <img alt="Logo L14 Corp, estilizado con letras L14 en azul oscuro" class="h-10 w-auto" height="40"
                src="/assets/images/L14_corp.png" width="80" />
            <div class="flex items-center gap-4">
                <select aria-label="Cambiar idioma"
                    class="border border-slate-300 rounded-md text-sm py-1 px-2 focus:outline-none focus:ring-2 focus:ring-blue-600">
                    <option selected value="es">English</option>
                    <option value="en">Español</option>
                    <option value="fr">Français</option>
                    <option value="de">Deutsch</option>
                </select>
            </div>
        </div>
    </header>

    <main class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 pt-20 pb-20 flex-grow">

        <div class="bg-white rounded-xl shadow-sm p-6 mb-8">
            <div class="mb-4">
                <h2 class="text-xl font-semibold mb-4">Detalles de la Reserva</h2>
                <div id="reservationDetails" class="text-slate-700">
                    <!-- Los detalles se llenarán con JavaScript -->
                </div>
            </div>

            <div class="mb-4">
                <h2 class="text-xl font-semibold mb-4">Información Personal</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label for="firstName" class="block text-sm font-medium text-slate-700 mb-1">Nombre</label>
                        <input type="text" id="firstName" class="w-full border border-slate-300 rounded-md px-4 py-2"
                            required>
                    </div>
                    <div>
                        <label for="lastName" class="block text-sm font-medium text-slate-700 mb-1">Apellido</label>
                        <input type="text" id="lastName" class="w-full border border-slate-300 rounded-md px-4 py-2"
                            required>
                    </div>
                    <div>
                        <label for="phone" class="block text-sm font-medium text-slate-700 mb-1">Número de
                            Celular</label>
                        <input type="tel" id="phone" class="w-full border border-slate-300 rounded-md px-4 py-2"
                            required>
                    </div>
                    <div>
                        <label for="email" class="block text-sm font-medium text-slate-700 mb-1">Correo
                            Electrónico</label>
                        <input type="email" id="email" class="w-full border border-slate-300 rounded-md px-4 py-2"
                            required>
                    </div>
                </div>
            </div>

            <div class="mb-4">
                <h2 class="text-xl font-semibold mb-4">Seleccionar Fechas</h2>
                <div class="flex flex-col gap-4">
                    <div>
                        <label for="dateRange" class="block text-sm font-medium text-slate-700 mb-1">Rango de
                            Fechas</label>
                        <input type="text" id="dateRange" class="w-full border border-slate-300 rounded-md px-4 py-2"
                            placeholder="Selecciona las fechas" readonly>
                    </div>
                </div>
            </div>

            <button id="submitReservation"
                class="w-full bg-blue-900 text-white font-semibold px-8 py-3 rounded-lg hover:bg-blue-800 transition">
                Confirmar Reserva
            </button>
        </div>
    </main>

    <footer class="text-center text-slate-500 text-sm mb-20 px-2">
        <p>© 2025 L14 Corp. Todos los derechos reservados.</p>
        <div class="flex justify-center gap-4 mt-3">
            <a href="https://x.com/L14Corp" target="_blank" rel="noopener noreferrer"
                class="text-slate-500 hover:text-blue-900 transition-colors" aria-label="Síguenos en X (Twitter)">
                <i class="fab fa-twitter text-lg"></i>
            </a>
            <a href="https://instagram.com/L14Corp" target="_blank" rel="noopener noreferrer"
                class="text-slate-500 hover:text-blue-900 transition-colors" aria-label="Síguenos en Instagram">
                <i class="fab fa-instagram text-lg"></i>
            </a>
            <a href="https://facebook.com/L14Corp" target="_blank" rel="noopener noreferrer"
                class="text-slate-500 hover:text-blue-900 transition-colors" aria-label="Síguenos en Facebook">
                <i class="fab fa-facebook text-lg"></i>
            </a>
        </div>
    </footer>

    <nav aria-label="Navegación inferior"
        class="fixed bottom-0 left-0 right-0 bg-white border-t border-slate-200 shadow-inner z-40">
        <ul class="flex justify-around max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-2 gap-3">
            <li class="flex-1">
                <a href="/index.html" title="Inicio"
                    class="flex items-center justify-center w-full py-3 text-center text-sm font-semibold rounded-md border border-transparent hover:border-blue-900 focus:outline-none transition text-slate-700 hover:text-blue-900">
                    <i class="fas fa-home text-lg"></i>
                </a>
            </li>
            <li class="flex-1">
                <a href="/pages/apartments.html" title="Departamentos"
                    class="flex items-center justify-center w-full py-3 text-center text-sm font-semibold rounded-md border border-transparent hover:border-blue-900 focus:outline-none transition text-slate-700 hover:text-blue-900">
                    <i class="fas fa-building text-lg"></i>
                </a>
            </li>
            <li class="flex-1">
                <a href="/pages/cars.html" title="Autos"
                    class="flex items-center justify-center w-full py-3 text-center text-sm font-semibold rounded-md border border-transparent hover:border-blue-900 focus:outline-none transition text-slate-700 hover:text-blue-900">
                    <i class="fas fa-car text-lg"></i>
                </a>
            </li>
            <li class="flex-1">
                <a href="/pages/planning.html" title="Planificación"
                    class="flex items-center justify-center w-full py-3 text-center text-sm font-semibold rounded-md border border-blue-900 bg-blue-900 text-white focus:outline-none transition">
                    <i class="fas fa-calendar-alt text-lg"></i>
                </a>
            </li>
            <li class="flex-1">
                <a href="/pages/about.html" title="Quienes Somos"
                    class="flex items-center justify-center w-full py-3 text-center text-sm font-semibold rounded-md border border-transparent hover:border-blue-900 focus:outline-none transition text-slate-700 hover:text-blue-900">
                    <i class="fas fa-info-circle text-lg"></i>
                </a>
            </li>
        </ul>
    </nav>
    <script src="/js/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Obtener parámetros de la URL
            const urlParams = new URLSearchParams(window.location.search);
            const aptId = urlParams.get('apt');
            const carId = urlParams.get('car');

            // Debugging
            console.log('Parámetros URL:', {
                carId: urlParams.get('car'),
                title: urlParams.get('title'),
                features: urlParams.get('features'),
                image: urlParams.get('image')
            });
            // Mostrar detalles de la reserva
            const reservationDetails = document.getElementById('reservationDetails');
            let detailsHTML = '';

            if (aptId) {
                // Detalles del apartamento
                detailsHTML = `
            <div class="space-y-4">
                <div class="flex justify-between items-center border-b border-slate-200 pb-2">
                    <span class="font-medium">Tipo:</span>
                    <span class="text-slate-600">Apartamento</span>
                </div>
                <div class="flex justify-between items-center border-b border-slate-200 pb-2">
                    <span class="font-medium">Referencia:</span>
                    <span class="text-slate-600">${urlParams.get('ref') || 'No disponible'}</span>
                </div>
                <div class="flex justify-between items-center border-b border-slate-200 pb-2">
                    <span class="font-medium">Edificio:</span>
                    <span class="text-slate-600">${urlParams.get('building') || 'No disponible'}</span>
                </div>
                <div class="flex justify-between items-center border-b border-slate-200 pb-2">
                    <span class="font-medium">Dirección:</span>
                    <span class="text-slate-600">${urlParams.get('address') || 'No disponible'}</span>
                </div>
                <div class="flex justify-between items-center border-b border-slate-200 pb-2">
                    <span class="font-medium">Precio por noche:</span>
                    <span class="text-slate-600">$${urlParams.get('price') || '0'} USD</span>
                </div>
                <div class="flex justify-between items-center border-b border-slate-200 pb-2">
                    <span class="font-medium">Gastos:</span>
                    <span class="text-slate-600">$${urlParams.get('expenses') || '0'} USD</span>
                </div>
                <div class="flex justify-between items-center border-b border-slate-200 pb-2">
                    <span class="font-medium">FOB (único pago):</span>
                    <span class="text-slate-600">$${urlParams.get('fob') || '0'} USD</span>
                </div>
                <div class="flex justify-between items-center border-b border-slate-200 pb-2">
                    <span class="font-medium">Estacionamiento:</span>
                    <span class="text-slate-600">$${urlParams.get('parking') || '0'} USD/día</span>
                </div>
            </div>
        `;

                // Agregar amenities si existen
                if (urlParams.has('amenities')) {
                    try {
                        const amenities = JSON.parse(urlParams.get('amenities'));
                        if (amenities.length > 0) {
                            detailsHTML += `
                        <div class="mt-6">
                            <h3 class="font-medium mb-3">Amenities:</h3>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
                                ${amenities.map(amenity => `
                                    <div class="flex items-center gap-2 text-slate-600">
                                        <i class="fas fa-check text-green-500"></i>
                                        <span>${amenity}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                        }
                    } catch (error) {
                        console.error('Error al procesar amenities:', error);
                    }
                }

                // Agregar descripción si existe
                if (urlParams.has('description')) {
                    detailsHTML += `
                <div class="mt-6">
                    <h3 class="font-medium mb-2">Descripción:</h3>
                    <p class="text-slate-600">${urlParams.get('description')}</p>
                </div>
            `;
                }

                // Agregar imagen si existe
                if (urlParams.has('image')) {
                    detailsHTML = `
                <div class="mb-6">
                    <img src="${urlParams.get('image')}" alt="Imagen del ${aptId ? 'apartamento' : 'vehículo'}" 
                         class="w-full h-48 object-cover rounded-lg shadow-sm">
                </div>
            ` + detailsHTML;
                }
            } else if (carId) {
                // Agregar la imagen primero
                if (urlParams.has('image')) {
                    detailsHTML = `
                        <div class="mb-6">
                            <img src="${urlParams.get('image')}" alt="Imagen del vehículo" 
                                 class="w-full h-48 object-cover rounded-lg shadow-sm">
                        </div>
                    ` + detailsHTML;
                }

                detailsHTML += `
                    <div class="space-y-4">
                        <div class="flex justify-between items-center border-b border-slate-200 pb-2">
                            <span class="font-medium">Tipo:</span>
                            <span class="text-slate-600">Vehículo</span>
                        </div>
                        <div class="flex justify-between items-center border-b border-slate-200 pb-2">
                            <span class="font-medium">Modelo:</span>
                            <span class="text-slate-600">${urlParams.get('title') || 'No especificado'}</span>
                        </div>
                        <div class="flex justify-between items-center border-b border-slate-200 pb-2">
                            <span class="font-medium">Características:</span>
                            <span class="text-slate-600">${urlParams.get('features')?.replace(/,/g, ', ') || 'No especificado'}</span>
                        </div>
                    </div>
                `;
            }

            reservationDetails.innerHTML = detailsHTML;

            // Configurar el calendario
            flatpickr("#dateRange", {
                mode: "range",
                minDate: "today",
                locale: "es",
                dateFormat: "Y-m-d",
                onChange: function (selectedDates) {
                    if (selectedDates.length === 2) {
                        // Eliminar el resumen anterior si existe
                        const resumenAnterior = document.querySelector('#resumenCostos');
                        if (resumenAnterior) {
                            resumenAnterior.remove();
                        }
                        calcularTotal(selectedDates[0], selectedDates[1]);
                    }
                }
            });

            // Función para calcular el total
            function calcularTotal(fechaInicio, fechaFin) {
                const dias = Math.ceil((fechaFin - fechaInicio) / (1000 * 60 * 60 * 24));
                let resumenHTML = '';

                if (aptId) {
                    const precioNoche = parseFloat(urlParams.get('price')) || 0;
                    const gastos = parseFloat(urlParams.get('expenses')) || 0;
                    const fob = parseFloat(urlParams.get('fob')) || 0;
                    const parking = parseFloat(urlParams.get('parking')) || 0;

                    const totalNoches = precioNoche * dias;
                    const totalParking = parking * dias;
                    const total = totalNoches + gastos + fob + totalParking;

                    resumenHTML = `
                <div id="resumenCostos" class="mt-6 p-4 bg-slate-50 rounded-lg">
                    <h3 class="font-medium mb-3">Resumen de Costos:</h3>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span>Alojamiento (${dias} noches x $${precioNoche}):</span>
                            <span>$${totalNoches.toFixed(2)} USD</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Gastos:</span>
                            <span>$${gastos.toFixed(2)} USD</span>
                        </div>
                        <div class="flex justify-between">
                            <span>FOB (único pago):</span>
                            <span>$${fob.toFixed(2)} USD</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Estacionamiento (${dias} días x $${parking}):</span>
                            <span>$${totalParking.toFixed(2)} USD</span>
                        </div>
                        <div class="flex justify-between font-semibold pt-2 border-t">
                            <span>Total:</span>
                            <span>$${total.toFixed(2)} USD</span>
                        </div>
                    </div>
                </div>
            `;
                } else if (carId) {
                    // Obtener el precio del auto desde los parámetros de la URL
                    const precioStr = urlParams.get('features')?.split(',').find(f => f.includes('$'))?.match(/\$(\d+)/)?.[1];
                    const precioDiario = parseFloat(precioStr) || 0;

                    const totalAlquiler = precioDiario * dias;
                    const seguro = 10 * dias; // Seguro diario
                    const sunpass = 5 * dias; // Sunpass diario
                    const total = totalAlquiler + seguro + sunpass;

                    resumenHTML = `
                <div id="resumenCostos" class="mt-6 p-4 bg-slate-50 rounded-lg">
                    <h3 class="font-medium mb-3">Resumen de Costos:</h3>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span>Alquiler (${dias} días x $${precioDiario}):</span>
                            <span>$${totalAlquiler.toFixed(2)} USD</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Seguro (${dias} días x $10):</span>
                            <span>$${seguro.toFixed(2)} USD</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Sunpass (${dias} días x $5):</span>
                            <span>$${sunpass.toFixed(2)} USD</span>
                        </div>
                        <div class="flex justify-between font-semibold pt-2 border-t">
                            <span>Total:</span>
                            <span>$${total.toFixed(2)} USD</span>
                        </div>
                    </div>
                </div>
            `;
                }

                document.getElementById('reservationDetails').insertAdjacentHTML('beforeend', resumenHTML);
            }

            // Manejar el envío del formulario
            document.getElementById('submitReservation').addEventListener('click', function () {
                const firstName = document.getElementById('firstName').value;
                const lastName = document.getElementById('lastName').value;
                const phone = document.getElementById('phone').value;
                const email = document.getElementById('email').value;
                const dateRange = document.getElementById('dateRange').value;

                if (!firstName || !lastName || !phone || !email || !dateRange) {
                    alert('Por favor, complete todos los campos requeridos');
                    return;
                }

                // Obtener el resumen de costos
                const resumenCostos = document.querySelector('#resumenCostos');
                const costoTotal = resumenCostos ?
                    resumenCostos.querySelector('.font-semibold span:last-child').textContent :
                    'No calculado';

                // Obtener detalles adicionales según el tipo de reserva
                const tipoReserva = aptId ? 'Apartamento' : 'Vehículo';
                const detallesReserva = aptId ? {
                    edificio: urlParams.get('building') || 'No especificado',
                    direccion: urlParams.get('address') || 'No especificado',
                    referencia: urlParams.get('ref') || 'No especificado'
                } : {
                    modelo: urlParams.get('title') || 'No especificado',
                    caracteristicas: urlParams.get('features') || 'No especificado'
                };

                // Crear el cuerpo del correo
                const mailBody = `
        Nueva Reserva:
        
        Datos del Cliente:
        - Nombre: ${firstName} ${lastName}
        - Email: ${email}
        - Teléfono: ${phone}
        - Fechas: ${dateRange}
        
        Detalles de la Reserva:
        - Tipo: ${tipoReserva}
        ${aptId ?
                        `- Edificio: ${detallesReserva.edificio}
            - Dirección: ${detallesReserva.direccion}
            - Referencia: ${detallesReserva.referencia}` :
                        `- Modelo: ${detallesReserva.modelo}
            - Características: ${detallesReserva.caracteristicas}`
                    }
        
        Costo Total: ${costoTotal}
    `;

                // Enviar el correo usando mailto
                const mailtoLink = `mailto:ciwl14corp@gmail.com?subject=Nueva Reserva - L14 Corp&body=${encodeURIComponent(mailBody)}`;
                window.location.href = mailtoLink;

                // Mostrar mensaje de confirmación
                alert('¡Gracias por su reserva! Se abrirá su cliente de correo para enviar los detalles.');
            });
        });

    </script>
</body>

</html>